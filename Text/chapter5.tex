\clearpage
\section{5 СРАВНЕНИЕ С КЛАССИЧЕСКОЙ РЕАЛИЗАЦИЕЙ}
В качестве тестового меша была использована модель Thai Statue из The Stanford 3D Scanning Repository~\cite{StanfordRepo}.

Для сравнения была написана вторая версия приложения отрисовки, использующая монолитные лоды.
Для указания версии используется определение макроса.

Для создания лодов был использован модификатор Decimate в Blender.
Размеры сгенерированных лодов приведены в таблице~\ref{tab:lod-sizes}.

\begin{table}[h]
    \centering

    \begin{tabular}{lrr}
        \hline \hline
        & Количество треугольников
        & Количество вершин \\ \hline
        LOD0 & 10 000 000 & 4 999 996 \\
        LOD1 &  1 000 000 &   499 996 \\
        LOD2 &    100 000 &    49 996 \\
        LOD3 &     10 000 &      4996 \\
        LOD4 &       1000 &       496 \\
        LOD5 &        100 &        46 \\
        LOD6 &         10 &        18 \\
        \hline \hline
    \end{tabular}

    \caption{Размеры лодов}
    \label{tab:lod-sizes}
\end{table}

При конвертации в граф мешлетов получен граф с характеристиками, указанными в таблице~\ref{tab:graph-sizes}.

\begin{table}[h]
    \centering

    \begin{tabular}{lr}
        \hline \hline
        Всего мешлетов    &    269 925 \\
        Истоков           &    104 167 \\
        Уникальных вершин &  6 166 095 \\
        Индексов          & 19 782 880 \\
        Всего примитивов  & 24 616 574 \\
        \hline \hline
    \end{tabular}

    \caption{Граф мешлетов}
    \label{tab:graph-sizes}
\end{table}

В процессе сравнения также была опробован метод отрисовки мешлетов без двойной индексации --- с разворачиванием массива вершин так, чтобы одному мешлету соответствовали записанные подряд в памяти вершины, а не записанные подряд в памяти индексы вершин.
При использовании вершин размером 24 байта и индексов размером 4 байта это даёт массив вершин размером 452.8 мегабайта (474~789~120 байт), в сравнении с суммарным размером массивов вершин и индексов в 216.6 мегабайт (227~117~800 байт), т.е. дополнительные 109\% потребляемой памяти.
Несмотря на это, подобный подход позволил увеличить производительность отрисовки, см. таблицу~\ref{tab:fps}.

Для замера производительности была настроена одинаковая сцена из 64 объектов, образующих куб 4 на 4 на 4, с отступом по горизонтали в 400 единиц (в том же масштабе, что и модель Thai Statue), по вертикали --- 600 единиц.
Расположение и направление взгляда камеры также было установлено одинаковым.
Для замеров приложение было запущено в полноэкранном режиме.

Замеры выполнялись на ноутбуке с 16 ГБ оперативной памяти, видеокартой NVidia GeForce RTX 3060 Laptop GPU, процессором AMD Ryzen 7 5800H (3201 МГц, 8 физических ядер, 16 логических процессоров), разрешением монитора 2560 на 1440 и частотой обновления 165 Гц.

Было измерено количество кадров в секунду (FPS), количество отправляемых на растеризацию примитивов, количество растеризуемых примитивов и количество вызовов пиксельного шейдера.

Скриншоты выполнения приведены на рисунках \ref{fig:impl-cluster-1}, \ref{fig:impl-cluster-2} и~\ref{fig:impl-mono}.
Результаты измерений приведены в таблице~\ref{tab:fps}.

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{pics/impl1.png}
    \caption{Кластерные лоды}
    \label{fig:impl-cluster-1}
\end{figure}

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{pics/impl2.png}
    \caption{Кластерные лоды, без массива индексов}
    \label{fig:impl-cluster-2}
\end{figure}

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{pics/impl3.png}
    \caption{Монолитные лоды}
    \label{fig:impl-mono}
\end{figure}

\begin{table}[h]
    \centering
    \begin{tabular}{lrrrr}
        \hline \hline
        Тип отрисовки
        & FPS
        & Отправлено
        & Растеризовано
        & Пикселей \\ \hline
        Монолитные лоды
        & \textbf{124.9}
        & 28 000 000
        & 21 412 299
        & 3 931 192 \\
        Кластерные лоды
        & 69.4
        & 11 545 791
        & 9 751 485
        & 2 864 864 \\
        \makecell[l]{Кластерные лоды,\\ без массива индексов}
        & 81.3
        & 11 545 791
        & 9 751 485
        & 2 864 864 \\
        \hline \hline
    \end{tabular}

    \caption{Сравнение производительности}
    \label{tab:fps}
\end{table}

На рисунках~\ref{fig:impl-heatmap-cluster} и~\ref{fig:impl-heatmap-mono} приведена визуализация площади отображаемых треугольников.
Красным цветом обозначены треугольники, проекции которых имеют площадь 1 пиксель, зелёным --- 3 пикселя, бирюзовым --- 7 пикселей, синим --- более 15 пикселей.

\begin{figure}[ht]
    \includegraphics[width=\textwidth]{pics/impl-heatmap-cluster.png}
    \caption{Площадь треугольников мешлетов}
    \label{fig:impl-heatmap-cluster}
\end{figure}

\begin{figure}[ht]
    \includegraphics[width=\textwidth]{pics/impl-heatmap-mono.png}
    \caption{Площадь треугольников лодов}
    \label{fig:impl-heatmap-mono}
\end{figure}

\subsection*{Итоги главы}
Сравнение с тривиальным алгоритмом монолитного лоддирования показало, что полученная реализация технологии процедурного кластерного видозависимого лоддирования пока проигрывает в производительности на 35\%.
Для исправления этого в дальнейших работах предлагается исследовать те оптимизации, предложенные в главе 3, которые не были реализованы в данной работе.
